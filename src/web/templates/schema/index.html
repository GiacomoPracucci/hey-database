{% extends "base.html" %}

{% block title %}Hey, Database! - Schema{% endblock %}

{# CSS specifici dello schema viewer #}
{% block extra_css %}
<link rel="stylesheet" href="{{ url_for('static', filename='styles/schema/schema-layout.css') }}"/>
<link rel="stylesheet" href="{{ url_for('static', filename='styles/schema/cytoscape-nodes.css') }}"/>
<link rel="stylesheet" href="{{ url_for('static', filename='styles/schema/controls.css') }}"/>

{# CSS per il pannello dei dettagli #}
<link rel="stylesheet" href="{{ url_for('static', filename='styles/schema/details-panel/details-panel-layout.css') }}"/>
<link rel="stylesheet" href="{{ url_for('static', filename='styles/schema/details-panel/columns-tab.css') }}"/>
<link rel="stylesheet" href="{{ url_for('static', filename='styles/schema/details-panel/data-preview-tab.css') }}"/>
<link rel="stylesheet" href="{{ url_for('static', filename='styles/schema/details-panel/overview-tab.css') }}"/>
<link rel="stylesheet" href="{{ url_for('static', filename='styles/schema/details-panel/relationships-tab.css') }}"/>
<link rel="stylesheet" href="{{ url_for('static', filename='styles/schema/details-panel/sql-assistant-tab.css') }}"/>
<link rel="stylesheet" href="{{ url_for('static', filename='styles/schema/details-panel/sql-examples-tab.css') }}"/>
<link rel="stylesheet" href="{{ url_for('static', filename='styles/schema/schema-responsiveness.css') }}"/>
{% endblock %}

{# Toolbar specifica dello schema viewer #}
{% block toolbar %}
<div class="toolbar-content">
    <div class="toolbar-left">
        <h1 class="page-title">Entity Relationship Diagram</h1>
        
        {# Controlli di layout #}
        <div class="control-group">
            <button id="autoArrangeBtn" class="btn btn-secondary">
                <i class="fas fa-project-diagram"></i>
                Auto Arrange
            </button>
            <select id="layoutSelect" class="select">
                <option value="dagre">Hierarchical View</option>
                <option value="cose">Organic View</option>
                <option value="concentric">Circular View</option>
                <option value="grid">Grid View</option>
            </select>
            
            {# Aggiunti i bottoni mancanti #}
            <button class="btn btn-secondary" data-action="highlight-central">
                <i class="fas fa-star"></i>
                Highlight Central Nodes
            </button>
            <button class="btn btn-secondary" data-action="reset">
                <i class="fas fa-undo"></i>
                Reset View
            </button>
        </div>
    </div>

    <div class="toolbar-right">
        {# Search box per la ricerca delle tabelle #}
        <div class="search-field">
            <i class="fas fa-search"></i>
            <input type="text" id="schemaSearch" placeholder="Search tables..." />
        </div>
    </div>
</div>
{% endblock %}

{# Contenuto principale dello schema viewer #}
{% block content %}
<div class="schema-container">
   {# Container principale per il grafo Cytoscape #}
   <div id="schemaViewer" class="schema-viewer"></div>
    <!-- Controlli zoom interni al viewer -->
    <div class="schema-controls">
        <button class="btn" id="zoomIn" title="Zoom In">
            <i class="fas fa-plus"></i>
        </button>
        <button class="btn" id="zoomOut" title="Zoom Out">
            <i class="fas fa-minus"></i>
        </button>
        <button class="btn" id="zoomFit" title="Fit to Screen">
            <i class="fas fa-expand"></i>
        </button>
    </div>

   {# Pannello dettagli tabella (nascosto di default) #}
   <div id="tableDetails" class="table-details hidden">
       <div class="details-header">
           <div class="header-left">
               <button class="details-back-button" style="display: none">
                   <i class="fas fa-arrow-left"></i>
               </button>
               <h3 class="details-title"></h3>
           </div>
           <button class="close-button" aria-label="Close details">
               <i class="fas fa-times"></i>
           </button>
       </div>
       <div class="details-content"></div>
   </div>

   {# Indicatore di caricamento #}
   <div id="loadingIndicator" class="loading-indicator">
       <div class="typing-indicator">
           <span></span>
           <span></span>
           <span></span>
       </div>
       <div class="loading-text">Loading schema...</div>
   </div>
</div>
{% endblock %}

{# Script JavaScript per lo schema viewer #}
{% block extra_js %}
   {# Librerie esterne necessarie per Cytoscape #}
   <script src="https://cdnjs.cloudflare.com/ajax/libs/cytoscape/3.19.1/cytoscape.min.js"></script>
   <script src="https://cdnjs.cloudflare.com/ajax/libs/dagre/0.8.5/dagre.min.js"></script>
   <script src="https://cdn.jsdelivr.net/npm/cytoscape-dagre@2.3.2/cytoscape-dagre.min.js"></script>

   {# Configurazione e utilities #}
   <script type="module" src="{{ url_for('static', filename='js/schema/config/styles.js') }}"></script>
   <script type="module" src="{{ url_for('static', filename='js/schema/utils/graphUtils.js') }}"></script>
   <script type="module" src="{{ url_for('static', filename='js/schema/utils/layoutUtils.js') }}"></script>

   {# Features dello schema viewer #}
   <script type="module" src="{{ url_for('static', filename='js/schema/features/search.js') }}"></script>
   <script type="module" src="{{ url_for('static', filename='js/schema/features/details.js') }}"></script>
   <script type="module" src="{{ url_for('static', filename='js/schema/features/controls.js') }}"></script>

   {# Entry point dell'applicazione #}
   <script type="module" src="{{ url_for('static', filename='js/schema/main.js') }}"></script>
{% endblock %}